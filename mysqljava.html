<!DOCTYPE HTML>
<!--
la pagina inventario petshop
-->
<html>
	<head>
		<title>Java y MySQL</title>		
<link  rel="icon"  href="images/lobo3.png" type="image/png">		<meta http-equiv="Content-Type" content="text/html;charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
		<!-- jQuery 1.8 or later, 33 KB -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

		<!-- Fotorama from CDNJS, 19 KB -->
		<link  href="https://cdnjs.cloudflare.com/ajax/libs/fotorama/4.6.4/fotorama.css" rel="stylesheet">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/fotorama/4.6.4/fotorama.js"></script>
	</head>
	<body class="is-preload">
<!-- Whatsapp-->
		<div class="btn-whatsapp">
			<a href="https://api.whatsapp.com/send?phone=542916450794" target="_blank">
				<img src="images/whatsapp.png" alt="" width="45" height="45">
				
			</a>
		</div>
		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<a href="#" class="logo">Java y MySQL</a>
					</header>

				<!-- Nav -->
					<nav id="nav">
						<ul class="links">
							<li><a href="index.html">Inicio</a></li>
							<li class="active"><a href="nortebus.html">Java y MySQL</a></li>
							<!--li><a href="elements.html">Elements Reference</a></li-->
						</ul>
						<ul class="icons">
							<li><a href="https://api.whatsapp.com/send?phone=542916450794&text=¡Hola!%20Me%20quiero%20comunicar%20con%20vos" target="_blank" class="icon brands fa-whatsapp"><span class="label">WhatsApp</span></a></li>
							<li><a href="https://www.youtube.com/channel/UCZUdNoXqD2aSVJ3tEEbV5uw" target="_blank" class="icon brands fa-youtube"><span class="label">Youtube</span></a></li>
							<li><a href="https://www.twitch.tv/mathyork" target="_blank" class="icon brands fa-twitch"><span class="label">Twitch</span></a></li>
							<li><a href="https://twitter.com/matiasriosj" target="_blank" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
							<li><a href="https://www.facebook.com/Ma7iasJRB" target="_blank" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
							<li><a href="https://www.instagram.com/matiasjrios" target="_blank" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
							<li><a href="https://github.com/MatiasJRB" target="_blank" class="icon brands fa-github"><span class="label">GitHub</span></a></li>
						</ul>
					</nav>

				<!-- Main -->
					<div id="main">

						<!-- Post -->
							<section class="post">
								<header class="major">
									<span class="date">5 de abril, 2020</span>
									<h1>Acceso remoto a base de datos </h1>
									<p>Futura mejora para Geome7ric<br />
									<br />
									</p>
								</header>
								<div class="image main"><img src="images/javasql/javasql.jpg" alt="" /></div>
								<p>  
								La motivación era poder autenticar usuarios para el inicio de sesión del programa, a fin de poder ofrecer el programa como servicio: mientras se pague el abono mensual los usuarios y contraseñas provistos al cliente no cambiarán y podrán acceder a usar el programa sin problemas, ante falta de pago, se le cambia la contraseña y se inhabilita el programa.
								</p>
								<p>
									Para la prueba, Salva creó una pequeña base de datos MySQL con una tabla 'usuarios' que contenía los atributos 'user' y 'password', creó el usuario 'userExterno' con todos los privilegios y la levantó en un servidor corriendo CentOS. Además habilitó el puerto '51552' para que yo me pueda conectar. Cuando terminó, yo disponía del usuario de la base de datos para conectarme con su correspondiente contraseña, la dirección ip del host y el puerto por el que debía comunicarme, i.e., todo lo que se requiere para establecer una conexión.
								</p>
								<p>
									Hice un nuevo proyecto Java Maven en la IDE Netbeans y una clase cuyo propósito era consultar el contenido de la tabla 'usuarios', modificar la pwd de uno de los usuarios y volver a consultar su contenido, para ver los cambios efectuados.
								</p>								
									
								<p>
									Los imports necesarios 
								</p>
								
								<p class="caja">
									import java.sql.DriverManager;</br>
									import java.sql.PreparedStatement;</br>
									import java.sql.ResultSet;</br>
									import java.sql.SQLException;</br>
									import java.sql.Statement;</br>
									import javax.swing.JOptionPane;</br>
									import java.sql.Connection;</br>
								</p>
								
								<p>
									Métodos
								</p>
								
								<p class="caja">
										public void establecerParametros()
										{
											driver = "com.ibm.db2.jcc.DB2Driver";
										servidor = "181.228.144.21:51552";
										baseDatos = "mjRios";
										usuario = "userExterno";
										clave = "passExterno";
										urlConexion = "jdbc:mysql://" + servidor + "/" + baseDatos;
										}
										
										public void ejecutarSelectPrueba()
										{
											System.out.println("---------\nEstado de la tabla Usuarios. \n --------------");
											String selectSQL= "select * from usuarios";
											mostrarContenidoRS(runSelect(selectSQL));
										}
										
										public void ejecutarUpdatePrueba()
										{
											String nuevaPassword=new String ("\"passJava\"");
											String updateSQL= "update usuarios set password="+nuevaPassword+" where user=\"matias\"";
											runUpdate(updateSQL);        
										}
										
											
										public ResultSet runSelect(String sql)
										{
											ResultSet toret=null;
											try{
												Statement stat = conet.createStatement();
												PreparedStatement preparedStmt = conet.prepareStatement(sql);
												toret = preparedStmt.executeQuery();
											}
											catch (Exception e)
											{
												e.printStackTrace();
											}
											return toret;    
										}
										
										public void mostrarContenidoRS(ResultSet rs)
										{
											if (rs!=null)
											{   
												try
												{
													while (rs.next()) 
													{
														System.out.println("user = " + rs.getString("user"));
														System.out.println("pass = " + rs.getString("password"));
													}   
												}
												catch(Exception ex)
												{
													JOptionPane.showMessageDialog(this,
														"Se produjo un error al intentar mostrar el contenido del Result Set.\n" + ex.getMessage(), "Error",
												JOptionPane.ERROR_MESSAGE);
												}
											}
										}
										
										
										public void runUpdate(String sql)
										{
											try{
												Statement stat = conet.createStatement();           
												PreparedStatement preparedStmt = conet.prepareStatement(sql);
												preparedStmt.executeUpdate();
											}
											catch (Exception ex)
											{
												JOptionPane.showMessageDialog(this,
														"Se produjo un error al intentar ejecutar el update= "+sql+"\n" + ex.getMessage(), "Error",
														JOptionPane.ERROR_MESSAGE);
												System.out.println("SQLException: " + ex.getMessage());
											}
										   
										
										}
										
										
									   
										private boolean conectarDB() 
										{
											boolean toret=false;
										   
											try 
													{
															//Class.forName("com.mysql.jdbc.Driver");  
												String driver = "com.ibm.db2.jcc.DB2Driver";
												String servidor = "181.228.144.21:51552";
												String baseDatos = "mjRios";
												String usuario = "userExterno";
												String clave = "passExterno";
												String urlConexion = "jdbc:mysql://" + servidor + "/" + baseDatos;
												
												conet = DriverManager.getConnection(urlConexion, usuario, clave);
															toret=true;
															System.out.println("Conecte a la database "+ baseDatos);
											} 
													catch (SQLException ex) 
													{
												JOptionPane.showMessageDialog(this,
														"Se produjo un error al intentar conectarse a la base de datos en conectarDB.\n" + ex.getMessage(), "Error",
														JOptionPane.ERROR_MESSAGE);
												System.out.println("SQLException: " + ex.getMessage());
												System.out.println("SQLState: " + ex.getSQLState());
												System.out.println("VendorError: " + ex.getErrorCode());
											} 
												return toret;
										}
								</p>
								
								<p>
									
								</p>
								
								<p>
								</p>
								
								
								
								<div class="fotorama">
										<img src="images/signos/programa1.png">
										<img src="images/signos/programa2.png">
										<img src="images/signos/programa3.png">
										<img src="images/signos/programa4.png">
										<img src="images/signos/programa5.png">
										<img src="images/signos/pagina.png">
								</div>	
								<p>  
								<a href= "https://www.instagram.com/signos_indumentaria/" > Signos indumentaria</a>				
								</p>
							</section>

					</div>

				<!-- Footer -->
					<footer id="footer">
						<section>
							<form method="POST" action="https://formspree.io/mjrcal95@hotmail.com.ar" class="form_contact">
								<div class="fields">
									<!--span class="fa fa-user-circle"></span-->
									<h2>¿PREGUNTAS?</h2>
									<!--div class="field">
										<label for="name">Nombre</label>
										<input type="text" name="name" id="name" />
									</div-->
									<div class="field">
										<label for="email">Email</label>
										<input type="text" name="email" id="email" />
									</div>
									<div class="field">
										<label for="message">Mensaje</label>
										<textarea name="message" id="message" rows="3"></textarea>
									</div>
								</div>
								<ul class="actions">
									<li><input type="submit" value="Enviar mensaje" /></li>
								</ul>
							</form>
						</section>
						<section class="split contact">
							<section class="alt">
								<h3>Localidad</h3>
								<p>Bahía Blanca, Buenos Aires<br />
								</p>
							</section>
							<section>
								<h3>Teléfono</h3>
								<p>
									<a href="tel://+54 (291) 645-0794">+54(291) 645-0794</a>
								</p>
							</section>
							<section>
								<h3>Email</h3>
								<p>
									<a href="mailto:mjrcal95@hotmail.com.ar">mjrcal95@hotmail.com.ar</a>
								</p>
							</section>
							<section>
								<h3>Social</h3>
								<ul class="icons alt">
									<li><a href="https://twitter.com/matiasriosj" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
									<li><a href="https://www.facebook.com/Ma7iasJRB" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
									<li><a href="https://www.instagram.com/matiasjrios" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
									<li><a href="https://github.com/MatiasJRB" class="icon brands fa-github"><span class="label">GitHub</span></a></li>
								</ul>
							</section>
						</section>
					</footer>

				<!-- Copyright -->
					<div id="copyright">
						<ul><li>&copy; MatiasJRB</li></ul>
					</div>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>